{
  "version": 3,
  "sources": ["../src/shapes/BaseShape.ts", "../src/shapes/Rect.ts", "../src/shapes/Circle.ts", "../src/shapes/Arrow.ts", "../src/shapes/Pen.ts", "../src/shapes/Text.ts", "../src/shapes/MosaicBrush.ts", "../src/core/HistoryManager.ts", "../src/core/Transformer.ts", "../src/core/Editor.ts", "../src/ui/Icons.ts", "../src/ui/Toolbar.ts", "../src/index.ts"],
  "sourcesContent": ["// Base Shape Class\r\n\r\nexport interface ShapeOptions {\r\n  x: number;\r\n  y: number;\r\n  strokeColor: string;\r\n  lineWidth: number;\r\n  rotation?: number; // In radians\r\n}\r\n\r\nexport abstract class BaseShape {\r\n  x: number;\r\n  y: number;\r\n  strokeColor: string;\r\n  lineWidth: number;\r\n  rotation: number = 0;\r\n  isSelected: boolean = false;\r\n\r\n  constructor(options: ShapeOptions) {\r\n    this.x = options.x;\r\n    this.y = options.y;\r\n    this.strokeColor = options.strokeColor;\r\n    this.lineWidth = options.lineWidth;\r\n    this.rotation = options.rotation || 0;\r\n  }\r\n\r\n  // Draw the shape content. The context will be pre-transformed (translated/rotated) if needed by the caller,\r\n  // OR the shape handles it.\r\n  // Strategy: Shape draws relative to its (x,y) but applies rotation around its center?\r\n  // Easier Strategy: Shape.draw() is responsible for applying its own rotation if it has one.\r\n  // But wait, if we rotate, the coordinate system changes.\r\n  abstract draw(ctx: CanvasRenderingContext2D): void;\r\n  \r\n  abstract hitTest(x: number, y: number): boolean;\r\n  abstract move(dx: number, dy: number): void;\r\n  abstract resize(x: number, y: number): void;\r\n  \r\n  // Clone for Undo/Redo\r\n  abstract clone(): BaseShape;\r\n\r\n  // Helper for applying rotation before drawing\r\n  protected applyRotation(ctx: CanvasRenderingContext2D, centerX: number, centerY: number) {\r\n    ctx.translate(centerX, centerY);\r\n    ctx.rotate(this.rotation);\r\n    ctx.translate(-centerX, -centerY);\r\n  }\r\n\r\n  protected pointToSegmentDistance(px: number, py: number, x1: number, y1: number, x2: number, y2: number): number {\r\n    const A = px - x1;\r\n    const B = py - y1;\r\n    const C = x2 - x1;\r\n    const D = y2 - y1;\r\n\r\n    const dot = A * C + B * D;\r\n    const lenSq = C * C + D * D;\r\n    let param = -1;\r\n    if (lenSq !== 0) param = dot / lenSq;\r\n\r\n    let xx, yy;\r\n\r\n    if (param < 0) {\r\n      xx = x1;\r\n      yy = y1;\r\n    } else if (param > 1) {\r\n      xx = x2;\r\n      yy = y2;\r\n    } else {\r\n      xx = x1 + param * C;\r\n      yy = y1 + param * D;\r\n    }\r\n\r\n    const dx = px - xx;\r\n    const dy = py - yy;\r\n    return Math.sqrt(dx * dx + dy * dy);\r\n  }\r\n}\r\n", "/*\n * @Author: YEYI millerye1995@foxmail.com\n * @Date: 2025-11-26 19:14:30\n * @LastEditors: YEYI millerye1995@foxmail.com\n * @LastEditTime: 2025-11-26 19:35:45\n * @FilePath: \\image-editor\\src\\shapes\\Rect.ts\n * @Description: \u8FD9\u662F\u9ED8\u8BA4\u8BBE\u7F6E,\u8BF7\u8BBE\u7F6E`customMade`, \u6253\u5F00koroFileHeader\u67E5\u770B\u914D\u7F6E \u8FDB\u884C\u8BBE\u7F6E: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE\n */\nimport { BaseShape, ShapeOptions } from './BaseShape';\n\nexport class Rect extends BaseShape {\n  width: number;\n  height: number;\n\n  constructor(options: ShapeOptions & { width: number; height: number }) {\n    super(options);\n    this.width = options.width;\n    this.height = options.height;\n  }\n\n  draw(ctx: CanvasRenderingContext2D): void {\n    ctx.save();\n    const centerX = this.x + this.width / 2;\n    const centerY = this.y + this.height / 2;\n    this.applyRotation(ctx, centerX, centerY);\n\n    ctx.beginPath();\n    ctx.strokeStyle = this.strokeColor;\n    ctx.lineWidth = this.lineWidth;\n    ctx.rect(this.x, this.y, this.width, this.height);\n    ctx.stroke();\n\n    ctx.restore();\n  }\n\n  hitTest(x: number, y: number): boolean {\n    // Inverse rotate point to check against axis-aligned rect\n    const centerX = this.x + this.width / 2;\n    const centerY = this.y + this.height / 2;\n    \n    // Translate point to center relative\n    const dx = x - centerX;\n    const dy = y - centerY;\n    \n    // Rotate point backwards\n    const cos = Math.cos(-this.rotation);\n    const sin = Math.sin(-this.rotation);\n    const rx = dx * cos - dy * sin;\n    const ry = dx * sin + dy * cos;\n    \n    // Translate back\n    const finalX = rx + centerX;\n    const finalY = ry + centerY;\n\n    return finalX >= this.x && finalX <= this.x + this.width && finalY >= this.y && finalY <= this.y + this.height;\n  }\n\n  move(dx: number, dy: number): void {\n    this.x += dx;\n    this.y += dy;\n  }\n\n  resize(x: number, y: number): void {\n    // Basic creation resize\n    this.width = x - this.x;\n    this.height = y - this.y;\n  }\n\n  clone(): Rect {\n    return new Rect({\n      x: this.x,\n      y: this.y,\n      width: this.width,\n      height: this.height,\n      strokeColor: this.strokeColor,\n      lineWidth: this.lineWidth,\n      rotation: this.rotation\n    });\n  }\n}\n", "/*\n * @Author: YEYI millerye1995@foxmail.com\n * @Date: 2025-11-26 19:14:49\n * @LastEditors: YEYI millerye1995@foxmail.com\n * @LastEditTime: 2025-11-26 19:36:34\n * @FilePath: \\image-editor\\src\\shapes\\Circle.ts\n * @Description: \u8FD9\u662F\u9ED8\u8BA4\u8BBE\u7F6E,\u8BF7\u8BBE\u7F6E`customMade`, \u6253\u5F00koroFileHeader\u67E5\u770B\u914D\u7F6E \u8FDB\u884C\u8BBE\u7F6E: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE\n */\nimport { BaseShape, ShapeOptions } from './BaseShape';\n\nexport class Circle extends BaseShape {\n  radius: number;\n\n  constructor(options: ShapeOptions & { radius: number }) {\n    super(options);\n    this.radius = options.radius;\n  }\n\n  draw(ctx: CanvasRenderingContext2D): void {\n    ctx.save();\n    // Circle center is x,y (wait, in original implementation x,y was center? No, user drags from center or corner? \n    // In original implementation: arc(this.x, this.y, ...) implies x,y is center.\n    // Let's stick to x,y is center for Circle.\n    this.applyRotation(ctx, this.x, this.y);\n\n    ctx.beginPath();\n    ctx.strokeStyle = this.strokeColor;\n    ctx.lineWidth = this.lineWidth;\n    ctx.arc(this.x, this.y, Math.abs(this.radius), 0, Math.PI * 2);\n    ctx.stroke();\n\n    ctx.restore();\n  }\n\n  hitTest(x: number, y: number): boolean {\n    // Rotation doesn't affect circle hit test if it's a perfect circle!\n    // But if we support non-uniform scaling (ellipse) later, it would.\n    // For now, distance check is enough.\n    const dx = x - this.x;\n    const dy = y - this.y;\n    return Math.sqrt(dx * dx + dy * dy) <= Math.abs(this.radius);\n  }\n\n  move(dx: number, dy: number): void {\n    this.x += dx;\n    this.y += dy;\n  }\n\n  resize(x: number, y: number): void {\n    const dx = x - this.x;\n    const dy = y - this.y;\n    this.radius = Math.sqrt(dx * dx + dy * dy);\n  }\n\n  clone(): Circle {\n    return new Circle({\n      x: this.x,\n      y: this.y,\n      radius: this.radius,\n      strokeColor: this.strokeColor,\n      lineWidth: this.lineWidth,\n      rotation: this.rotation\n    });\n  }\n}\n", "import { BaseShape, ShapeOptions } from './BaseShape';\r\n\r\nexport class Arrow extends BaseShape {\r\n  endX: number;\r\n  endY: number;\r\n\r\n  constructor(options: ShapeOptions & { endX: number; endY: number }) {\r\n    super(options);\r\n    this.endX = options.endX;\r\n    this.endY = options.endY;\r\n  }\r\n\r\n  draw(ctx: CanvasRenderingContext2D): void {\r\n    ctx.save();\r\n    const centerX = (this.x + this.endX) / 2;\r\n    const centerY = (this.y + this.endY) / 2;\r\n    this.applyRotation(ctx, centerX, centerY);\r\n\r\n    const headLength = 15;\r\n    const dx = this.endX - this.x;\r\n    const dy = this.endY - this.y;\r\n    const angle = Math.atan2(dy, dx);\r\n\r\n    ctx.beginPath();\n    ctx.strokeStyle = this.strokeColor;\n    ctx.lineWidth = this.lineWidth;\n    \n    // Main line\n    ctx.moveTo(this.x, this.y);\n    ctx.lineTo(this.endX, this.endY);\n    ctx.stroke(); // Draw the line\n    \n    // Arrow head\n    ctx.beginPath();\n    ctx.moveTo(this.endX, this.endY);\n    ctx.lineTo(this.endX - headLength * Math.cos(angle - Math.PI / 6), this.endY - headLength * Math.sin(angle - Math.PI / 6));\n    ctx.lineTo(this.endX - headLength * Math.cos(angle + Math.PI / 6), this.endY - headLength * Math.sin(angle + Math.PI / 6));\n    ctx.closePath();\n    ctx.fillStyle = this.strokeColor;\n    ctx.fill();\n    \n    ctx.restore();\n  }\r\n\r\n  hitTest(x: number, y: number): boolean {\r\n    // Basic line hit test with rotation\r\n    const centerX = (this.x + this.endX) / 2;\r\n    const centerY = (this.y + this.endY) / 2;\r\n    \r\n    const dx = x - centerX;\r\n    const dy = y - centerY;\r\n    const cos = Math.cos(-this.rotation);\r\n    const sin = Math.sin(-this.rotation);\r\n    const rx = dx * cos - dy * sin;\r\n    const ry = dx * sin + dy * cos;\r\n    const finalX = rx + centerX;\r\n    const finalY = ry + centerY;\r\n\r\n    const dist = this.pointToLineDistance(finalX, finalY, this.x, this.y, this.endX, this.endY);\r\n    return dist < 10;\r\n  }\r\n\r\n  move(dx: number, dy: number): void {\r\n    this.x += dx;\r\n    this.y += dy;\r\n    this.endX += dx;\r\n    this.endY += dy;\r\n  }\r\n\r\n  resize(x: number, y: number): void {\r\n    this.endX = x;\r\n    this.endY = y;\r\n  }\r\n\r\n  clone(): Arrow {\r\n    return new Arrow({\r\n      x: this.x,\r\n      y: this.y,\r\n      endX: this.endX,\r\n      endY: this.endY,\r\n      strokeColor: this.strokeColor,\r\n      lineWidth: this.lineWidth,\r\n      rotation: this.rotation\r\n    });\r\n  }\r\n\r\n  private pointToLineDistance(x: number, y: number, x1: number, y1: number, x2: number, y2: number) {\r\n    const A = x - x1;\r\n    const B = y - y1;\r\n    const C = x2 - x1;\r\n    const D = y2 - y1;\r\n\r\n    const dot = A * C + B * D;\r\n    const lenSq = C * C + D * D;\r\n    let param = -1;\r\n    if (lenSq !== 0) param = dot / lenSq;\r\n\r\n    let xx, yy;\r\n\r\n    if (param < 0) {\r\n      xx = x1;\r\n      yy = y1;\r\n    } else if (param > 1) {\r\n      xx = x2;\r\n      yy = y2;\r\n    } else {\r\n      xx = x1 + param * C;\r\n      yy = y1 + param * D;\r\n    }\r\n\r\n    const dx = x - xx;\r\n    const dy = y - yy;\r\n    return Math.sqrt(dx * dx + dy * dy);\r\n  }\r\n}\r\n", "import { BaseShape, ShapeOptions } from './BaseShape';\n\nexport class PenPath extends BaseShape {\n  points: { x: number; y: number }[];\n\n  constructor(options: ShapeOptions & { points: { x: number; y: number }[] }) {\n    super(options);\n    this.points = options.points.map(p => ({ ...p })); // Deep copy points\n  }\n\n  draw(ctx: CanvasRenderingContext2D): void {\n    if (this.points.length < 2) return;\n\n    ctx.save();\n    // For freehand path, finding center is O(N).\n    // To support rotation, we really should compute bounds once or cache them.\n    const bounds = this.getBounds();\n    const centerX = (bounds.minX + bounds.maxX) / 2;\n    const centerY = (bounds.minY + bounds.maxY) / 2;\n    \n    this.applyRotation(ctx, centerX, centerY);\n\n    ctx.beginPath();\n    ctx.strokeStyle = this.strokeColor;\n    ctx.lineWidth = this.lineWidth;\n    ctx.lineCap = 'round';\n    ctx.lineJoin = 'round';\n\n    ctx.moveTo(this.points[0].x, this.points[0].y);\n    for (let i = 1; i < this.points.length; i++) {\n      ctx.lineTo(this.points[i].x, this.points[i].y);\n    }\n    ctx.stroke();\n    \n    ctx.restore();\n  }\n\n  hitTest(x: number, y: number): boolean {\n    return false; // Disable selection for pen\n  }\n\n  move(dx: number, dy: number): void {\n    this.points.forEach(p => {\n      p.x += dx;\n      p.y += dy;\n    });\n    this.x += dx;\n    this.y += dy;\n  }\n\n  resize(x: number, y: number): void {\n    // Skipping complex path resize\n  }\n\n  clone(): PenPath {\n    return new PenPath({\n      x: this.x,\n      y: this.y,\n      points: this.points, // Constructor copies\n      strokeColor: this.strokeColor,\n      lineWidth: this.lineWidth,\n      rotation: this.rotation\n    });\n  }\n\n  private getBounds() {\n    let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;\n    if (this.points.length === 0) return { minX: this.x, minY: this.y, maxX: this.x, maxY: this.y };\n    \n    this.points.forEach(p => {\n      if (p.x < minX) minX = p.x;\n      if (p.y < minY) minY = p.y;\n      if (p.x > maxX) maxX = p.x;\n      if (p.y > maxY) maxY = p.y;\n    });\n    return { minX, minY, maxX, maxY };\n  }\n}\n", "/*\n * @Author: YEYI millerye1995@foxmail.com\n * @Date: 2025-11-26 19:15:38\n * @LastEditors: YEYI millerye1995@foxmail.com\n * @LastEditTime: 2025-11-26 20:21:27\n * @FilePath: \\image-editor\\src\\shapes\\Text.ts\n * @Description: \u8FD9\u662F\u9ED8\u8BA4\u8BBE\u7F6E,\u8BF7\u8BBE\u7F6E`customMade`, \u6253\u5F00koroFileHeader\u67E5\u770B\u914D\u7F6E \u8FDB\u884C\u8BBE\u7F6E: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE\n */\nimport { BaseShape, ShapeOptions } from './BaseShape';\n\nexport class TextShape extends BaseShape {\n  text: string;\n  fontSize: number = 20;\n  fontFamily: string = 'Arial';\n\n  constructor(options: ShapeOptions & { text: string }) {\n    super(options);\n    this.text = options.text;\n  }\n\n  draw(ctx: CanvasRenderingContext2D): void {\n    ctx.save();\n    ctx.font = `${this.fontSize}px ${this.fontFamily}`;\n    \n    const lines = this.text.split('\\n');\n    let maxWidth = 0;\n    lines.forEach(line => {\n        const w = ctx.measureText(line).width;\n        if (w > maxWidth) maxWidth = w;\n    });\n    const lineHeight = this.fontSize * 1.2;\n    const totalHeight = lines.length * lineHeight;\n\n    const centerX = this.x + maxWidth / 2;\n    const centerY = this.y + totalHeight / 2;\n    \n    this.applyRotation(ctx, centerX, centerY);\n\n    ctx.fillStyle = this.strokeColor;\n    ctx.textBaseline = 'top';\n    lines.forEach((line, index) => {\n        ctx.fillText(line, this.x, this.y + index * lineHeight);\n    });\n\n    ctx.restore();\n  }\n\n  hitTest(x: number, y: number): boolean {\n    // Need context to measure properly, but approximation is okay for hit test\n    const lines = this.text.split('\\n');\n    const estimatedWidth = lines.reduce((max, line) => Math.max(max, line.length * (this.fontSize * 0.6)), 0);\n    const lineHeight = this.fontSize * 1.2;\n    const totalHeight = lines.length * lineHeight;\n\n    const centerX = this.x + estimatedWidth / 2;\n    const centerY = this.y + totalHeight / 2;\n\n    const dx = x - centerX;\n    const dy = y - centerY;\n    const cos = Math.cos(-this.rotation);\n    const sin = Math.sin(-this.rotation);\n    const rx = dx * cos - dy * sin;\n    const ry = dx * sin + dy * cos;\n    const finalX = rx + centerX;\n    const finalY = ry + centerY;\n\n    return finalX >= this.x && finalX <= this.x + estimatedWidth && finalY >= this.y && finalY <= this.y + totalHeight;\n  }\n\n  move(dx: number, dy: number): void {\n    this.x += dx;\n    this.y += dy;\n  }\n\n  resize(x: number, y: number): void {\n    // Text resize usually changes font size?\n    // Or just skip for now.\n  }\n\n  clone(): TextShape {\n    return new TextShape({\n      x: this.x,\n      y: this.y,\n      text: this.text,\n      strokeColor: this.strokeColor,\n      lineWidth: this.lineWidth,\n      rotation: this.rotation\n    });\n  }\n\n  getBounds(ctx: CanvasRenderingContext2D) {\n    ctx.save();\n    ctx.font = `${this.fontSize}px ${this.fontFamily}`;\n    const lines = this.text.split('\\n');\n    let maxWidth = 0;\n    lines.forEach(line => {\n        const w = ctx.measureText(line).width;\n        if (w > maxWidth) maxWidth = w;\n    });\n    const lineHeight = this.fontSize * 1.2;\n    const totalHeight = lines.length * lineHeight;\n    ctx.restore();\n\n    return {\n        x: this.x,\n        y: this.y,\n        width: maxWidth,\n        height: totalHeight\n    };\n  }\n}\n", "import { BaseShape, ShapeOptions } from './BaseShape';\r\n\r\nexport class MosaicBrush extends BaseShape {\r\n  points: { x: number; y: number }[];\r\n  pattern: CanvasPattern | null = null; // We need to inject this or context needs to provide it\r\n\r\n  constructor(options: ShapeOptions & { points: { x: number; y: number }[] }) {\r\n    super(options);\r\n    this.points = options.points.map(p => ({ ...p }));\r\n  }\r\n\r\n  // The MosaicBrush needs the pixelated pattern to draw. \r\n  // Since draw() only gets ctx, we rely on the caller (Editor) to have set the strokeStyle to the pattern \r\n  // OR we store it. Storing pattern is tricky if background changes.\r\n  // But for this specific use case, we can assume the pattern is static for the session unless background changes.\r\n  // However, `draw` is called often.\r\n  // Let's rely on `strokeColor` being hijackable OR we just use a global/static resource if needed.\r\n  // Better: We add a `setPattern` method or pass it in options.\r\n  // Actually, we can just say: The Editor sets the pattern as `strokeStyle` BEFORE calling draw if it detects this shape type?\r\n  // No, `draw` sets the strokeStyle.\r\n  // Let's add a public property `mosaicPattern`.\r\n  \r\n  draw(ctx: CanvasRenderingContext2D): void {\r\n    if (this.points.length < 2) return;\r\n\r\n    ctx.save();\r\n    \r\n    // Bounds for rotation center\r\n    const bounds = this.getBounds();\r\n    const centerX = (bounds.minX + bounds.maxX) / 2;\r\n    const centerY = (bounds.minY + bounds.maxY) / 2;\r\n    this.applyRotation(ctx, centerX, centerY);\r\n\r\n    ctx.beginPath();\r\n    // We use the injected pattern if available, else fallback\r\n    if (this.pattern) {\r\n        ctx.strokeStyle = this.pattern;\r\n    } else {\r\n        ctx.strokeStyle = 'rgba(0,0,0,0.1)'; // Debug fallback\r\n    }\r\n    \r\n    ctx.lineWidth = this.lineWidth;\r\n    ctx.lineCap = 'round';\r\n    ctx.lineJoin = 'round';\r\n\r\n    ctx.moveTo(this.points[0].x, this.points[0].y);\r\n    for (let i = 1; i < this.points.length; i++) {\r\n      ctx.lineTo(this.points[i].x, this.points[i].y);\r\n    }\r\n    ctx.stroke();\r\n\r\n    ctx.restore();\r\n  }\r\n\r\n  hitTest(x: number, y: number): boolean {\n    return false; // Disable selection for mosaic\n  }\r\n\r\n  move(dx: number, dy: number): void {\r\n    this.points.forEach(p => {\r\n      p.x += dx;\r\n      p.y += dy;\r\n    });\r\n    this.x += dx;\r\n    this.y += dy;\r\n  }\r\n\r\n  resize(x: number, y: number): void {\r\n  }\r\n\r\n  clone(): MosaicBrush {\r\n    const clone = new MosaicBrush({\r\n      x: this.x,\r\n      y: this.y,\r\n      points: this.points,\r\n      strokeColor: this.strokeColor,\r\n      lineWidth: this.lineWidth,\r\n      rotation: this.rotation\r\n    });\r\n    clone.pattern = this.pattern;\r\n    return clone;\r\n  }\r\n\r\n  private getBounds() {\r\n    let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;\r\n    if (this.points.length === 0) return { minX: this.x, minY: this.y, maxX: this.x, maxY: this.y };\r\n    \r\n    this.points.forEach(p => {\r\n      if (p.x < minX) minX = p.x;\r\n      if (p.y < minY) minY = p.y;\r\n      if (p.x > maxX) maxX = p.x;\r\n      if (p.y > maxY) maxY = p.y;\r\n    });\r\n    return { minX, minY, maxX, maxY };\r\n  }\r\n}\r\n", "/*\r\n * @Author: YEYI millerye1995@foxmail.com\r\n * @Date: 2025-11-26 19:40:21\r\n * @LastEditors: YEYI millerye1995@foxmail.com\r\n * @LastEditTime: 2025-11-26 19:40:24\r\n * @FilePath: \\image-editor\\src\\core\\HistoryManager.ts\r\n * @Description: \u8FD9\u662F\u9ED8\u8BA4\u8BBE\u7F6E,\u8BF7\u8BBE\u7F6E`customMade`, \u6253\u5F00koroFileHeader\u67E5\u770B\u914D\u7F6E \u8FDB\u884C\u8BBE\u7F6E: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE\r\n */\r\nimport { BaseShape } from '../shapes/BaseShape';\r\n\r\nexport class HistoryManager {\r\n  private undoStack: BaseShape[][] = [];\r\n  private redoStack: BaseShape[][] = [];\r\n  private limit: number = 20;\r\n\r\n  push(state: BaseShape[]) {\r\n    // Deep clone state\r\n    const clone = state.map(s => s.clone());\r\n    this.undoStack.push(clone);\r\n    if (this.undoStack.length > this.limit) {\r\n      this.undoStack.shift();\r\n    }\r\n    // Clear redo stack on new action\r\n    this.redoStack = [];\r\n  }\r\n\r\n  undo(currentState: BaseShape[]): BaseShape[] | null {\r\n    if (this.undoStack.length === 0) return null;\r\n    \r\n    // Save current state to redo stack before undoing\r\n    const currentClone = currentState.map(s => s.clone());\r\n    this.redoStack.push(currentClone);\r\n\r\n    const prevState = this.undoStack.pop();\r\n    // We need to clone the popped state so it stays \"fresh\" if we push it back later?\r\n    // Actually, popped state is ours now.\r\n    return prevState ? prevState.map(s => s.clone()) : null;\r\n  }\r\n\r\n  redo(currentState: BaseShape[]): BaseShape[] | null {\r\n    if (this.redoStack.length === 0) return null;\r\n\r\n    // Save current to undo stack\r\n    const currentClone = currentState.map(s => s.clone());\r\n    this.undoStack.push(currentClone);\r\n\r\n    const nextState = this.redoStack.pop();\r\n    return nextState ? nextState.map(s => s.clone()) : null;\r\n  }\r\n  \r\n  clear() {\r\n    this.undoStack = [];\r\n    this.redoStack = [];\r\n  }\r\n}\r\n", "import { BaseShape } from '../shapes/BaseShape';\n\nexport class Transformer {\n  private shape: BaseShape | null = null;\n  private handleSize = 10;\n  private rotateHandleOffset = 30;\n\n  // Handles:\n  // 0: top-left, 1: top-right, 2: bottom-right, 3: bottom-left\n  // 4: rotate (top-center)\n  // For paths, we might only support bounds resizing which scales the path.\n\n  attach(shape: BaseShape | null) {\n    this.shape = shape;\n  }\n\n  draw(ctx: CanvasRenderingContext2D) {\n    if (!this.shape) return;\n\n    ctx.save();\n    \n    // Get bounds and center\n    const bounds = this.getShapeBounds(this.shape, ctx);\n    const centerX = bounds.x + bounds.width / 2;\n    const centerY = bounds.y + bounds.height / 2;\n\n    // Apply rotation\n    ctx.translate(centerX, centerY);\n    ctx.rotate(this.shape.rotation);\n    ctx.translate(-centerX, -centerY);\n\n    // Draw bounding box\n    ctx.strokeStyle = '#00a8ff';\n    ctx.lineWidth = 1;\n    ctx.strokeRect(bounds.x, bounds.y, bounds.width, bounds.height);\n\n    // Draw handles\n    ctx.fillStyle = '#ffffff';\n    ctx.strokeStyle = '#00a8ff';\n\n    const corners = [\n      { x: bounds.x, y: bounds.y }, // TL\n      { x: bounds.x + bounds.width, y: bounds.y }, // TR\n      { x: bounds.x + bounds.width, y: bounds.y + bounds.height }, // BR\n      { x: bounds.x, y: bounds.y + bounds.height } // BL\n    ];\n\n    corners.forEach(c => {\n      ctx.fillRect(c.x - this.handleSize / 2, c.y - this.handleSize / 2, this.handleSize, this.handleSize);\n      ctx.strokeRect(c.x - this.handleSize / 2, c.y - this.handleSize / 2, this.handleSize, this.handleSize);\n    });\n\n    // Rotate Handle\n    const rotateX = bounds.x + bounds.width / 2;\n    const rotateY = bounds.y - this.rotateHandleOffset;\n    \n    ctx.beginPath();\n    ctx.moveTo(rotateX, bounds.y);\n    ctx.lineTo(rotateX, rotateY);\n    ctx.stroke();\n\n    ctx.beginPath();\n    ctx.arc(rotateX, rotateY, this.handleSize / 2, 0, Math.PI * 2);\n    ctx.fill();\n    ctx.stroke();\n\n    ctx.restore();\n  }\n\n  // Returns handle index: 0-3 corners, 4 rotate, -1 none, -2 inside (drag)\n  hitTest(x: number, y: number, ctx?: CanvasRenderingContext2D): number {\n    if (!this.shape) return -1;\n\n    const bounds = this.getShapeBounds(this.shape, ctx);\n    const centerX = bounds.x + bounds.width / 2;\n    const centerY = bounds.y + bounds.height / 2;\n\n    // Transform mouse point to local unrotated space\n    const dx = x - centerX;\n    const dy = y - centerY;\n    const cos = Math.cos(-this.shape.rotation);\n    const sin = Math.sin(-this.shape.rotation);\n    const localX = dx * cos - dy * sin + centerX;\n    const localY = dx * sin + dy * cos + centerY;\n\n    // Check rotate handle\n    const rotateX = bounds.x + bounds.width / 2;\n    const rotateY = bounds.y - this.rotateHandleOffset;\n    if (this.dist(localX, localY, rotateX, rotateY) < this.handleSize) return 4;\n\n    // Check corners\n    const corners = [\n      { x: bounds.x, y: bounds.y },\n      { x: bounds.x + bounds.width, y: bounds.y },\n      { x: bounds.x + bounds.width, y: bounds.y + bounds.height },\n      { x: bounds.x, y: bounds.y + bounds.height }\n    ];\n\n    for (let i = 0; i < corners.length; i++) {\n      if (this.dist(localX, localY, corners[i].x, corners[i].y) < this.handleSize) return i;\n    }\n\n    // Check inside\n    if (localX >= bounds.x && localX <= bounds.x + bounds.width &&\n        localY >= bounds.y && localY <= bounds.y + bounds.height) {\n      return -2;\n    }\n\n    return -1;\n  }\n\n  private dist(x1: number, y1: number, x2: number, y2: number) {\n    return Math.sqrt((x1-x2)**2 + (y1-y2)**2);\n  }\n\n  getShapeBounds(shape: BaseShape, ctx?: CanvasRenderingContext2D) {\n    // Check if shape has getBounds\n    if ('getBounds' in shape && typeof (shape as any).getBounds === 'function' && ctx) {\n        return (shape as any).getBounds(ctx);\n    }\n\n    // Return unrotated bounds relative to shape x,y\n    // For Rect/Text/Circle/Mosaic, x/y/w/h are standard.\n    // For Pen/Arrow, we need to calculate.\n    \n    // Simplification: We rely on shapes having width/height or calculating it.\n    // BaseShape doesn't have width/height. We need to cast.\n    \n    if ('width' in shape && 'height' in shape) {\n        return { x: shape.x, y: shape.y, width: (shape as any).width, height: (shape as any).height };\n    }\n    if ('radius' in shape) {\n        const s = shape as any;\n        return { x: s.x - s.radius, y: s.y - s.radius, width: s.radius * 2, height: s.radius * 2 };\n    }\n    if ('points' in shape) {\n        const s = shape as any;\n        // Points are absolute. We need their bounds.\n        // We implemented getBounds in PenPath but it's private.\n        // Let's re-calculate here or make it public.\n        // Recalculating is safer as we don't depend on implementation details.\n        let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;\n        s.points.forEach((p: any) => {\n            if (p.x < minX) minX = p.x;\n            if (p.y < minY) minY = p.y;\n            if (p.x > maxX) maxX = p.x;\n            if (p.y > maxY) maxY = p.y;\n        });\n        return { x: minX, y: minY, width: maxX - minX, height: maxY - minY };\n    }\n    if ('endX' in shape) {\n        const s = shape as any;\n        const minX = Math.min(s.x, s.endX);\n        const minY = Math.min(s.y, s.endY);\n        const maxX = Math.max(s.x, s.endX);\n        const maxY = Math.max(s.y, s.endY);\n        return { x: minX, y: minY, width: maxX - minX, height: maxY - minY };\n    }\n    \n    return { x: shape.x, y: shape.y, width: 0, height: 0 };\n  }\n}\n", "import { BaseShape } from '../shapes/BaseShape';\nimport { Rect } from '../shapes/Rect';\nimport { Circle } from '../shapes/Circle';\nimport { Arrow } from '../shapes/Arrow';\nimport { PenPath } from '../shapes/Pen';\nimport { TextShape } from '../shapes/Text';\nimport { MosaicBrush } from '../shapes/MosaicBrush';\nimport { HistoryManager } from './HistoryManager';\nimport { Transformer } from './Transformer';\n\nexport type ToolType = 'select' | 'rect' | 'circle' | 'arrow' | 'pen' | 'text' | 'mosaic';\n\nexport interface EditorOptions {\n  container: HTMLElement;\n  width?: number;\n  height?: number;\n  backgroundImage?: string;\n  backgroundColor?: string;\n  locale?: 'zh' | 'en';\n}\n\nexport class ImageEditor {\n  private container: HTMLElement;\n  private canvas: HTMLCanvasElement;\n  private ctx: CanvasRenderingContext2D;\n  private shapes: BaseShape[] = [];\n  private currentTool: ToolType = 'select';\n  private currentColor: string = '#ff0000';\n  private currentLineWidth: number = 2;\n  private isDragging: boolean = false;\n  private startX: number = 0;\n  private startY: number = 0;\n  private currentShape: BaseShape | null = null;\n  private selectedShape: BaseShape | null = null;\n  private backgroundImage: HTMLImageElement | null = null;\n  private backgroundColor: string = '#ffffff';\n  private mousePos: { x: number; y: number } | null = null;\n  private textArea!: HTMLTextAreaElement;\n  private activeTextShape: TextShape | null = null;\n  public locale: 'zh' | 'en' = 'zh'; // Default Chinese\n\n  // For Pen tool\n  private currentPenPath: { x: number; y: number }[] = [];\n\n  // New modules\n  private historyManager: HistoryManager;\n  private transformer: Transformer;\n  \n  // State for interaction\n  private transformAction: string | null = null; // 'drag', 'rotate', 'resize-tl', etc. (simplified to handle index)\n  private transformHandleIndex: number = -1;\n\n  constructor(options: EditorOptions) {\n    this.container = options.container;\n    if (getComputedStyle(this.container).position === 'static') {\n        this.container.style.position = 'relative';\n    }\n    this.canvas = document.createElement('canvas');\n    this.ctx = this.canvas.getContext('2d', { willReadFrequently: true })!;\n    \n    this.container.appendChild(this.canvas);\n    this.resizeCanvas(options.width || 800, options.height || 600);\n    \n    if (options.locale) {\n        this.locale = options.locale;\n    }\n\n    this.historyManager = new HistoryManager();\n    this.transformer = new Transformer();\n\n    if (options.backgroundColor) {\n      this.backgroundColor = options.backgroundColor;\n    }\n\n    if (options.backgroundImage) {\n      const img = new Image();\n      img.src = options.backgroundImage;\n      img.crossOrigin = \"Anonymous\";\n      img.onload = () => {\n        this.backgroundImage = img;\n        this.render();\n      };\n    }\n\n    this.initTextArea();\n    this.initEvents();\n    this.render();\n  }\n\n  private initTextArea() {\n    this.textArea = document.createElement('textarea');\n    this.textArea.style.position = 'absolute';\n    this.textArea.style.display = 'none';\n    this.textArea.style.background = 'transparent';\n    this.textArea.style.border = '1px dashed #ccc';\n    this.textArea.style.outline = 'none';\n    this.textArea.style.padding = '0';\n    this.textArea.style.margin = '0';\n    this.textArea.style.resize = 'none';\n    this.textArea.style.overflow = 'hidden';\n    this.textArea.style.zIndex = '1000';\n    this.textArea.style.font = '20px Arial'; \n    this.textArea.style.lineHeight = '1.2';\n    this.textArea.style.whiteSpace = 'nowrap';\n    this.textArea.style.color = this.currentColor;\n    \n    this.container.appendChild(this.textArea);\n\n    this.textArea.addEventListener('input', () => {\n        this.textArea.value = this.textArea.value.replace(/\\n/g, '');\n        this.textArea.style.width = '0';\n        this.textArea.style.height = '0';\n        this.textArea.style.width = (this.textArea.scrollWidth + 10) + 'px';\n        this.textArea.style.height = (this.textArea.scrollHeight + 10) + 'px';\n    });\n\n    this.textArea.addEventListener('keydown', (e) => {\n        if (e.key === 'Enter') {\n            e.preventDefault();\n            this.finishTextEditing();\n        }\n    });\n\n    this.textArea.addEventListener('blur', () => {\n        // Delay slightly to allow click events to register if needed, \n        // but generally blur commit is fine.\n        setTimeout(() => this.finishTextEditing(), 100);\n    });\n  }\n\n  private finishTextEditing() {\n    if (this.textArea.style.display === 'none') return;\n\n    const val = this.textArea.value;\n    if (val.trim()) {\n        if (this.activeTextShape) {\n             // Edit existing\n             if (this.activeTextShape.text !== val) {\n                 this.saveState();\n                 this.activeTextShape.text = val;\n             }\n        } else {\n             // New shape\n             this.saveState();\n             const rect = this.textArea.getBoundingClientRect();\n             const containerRect = this.container.getBoundingClientRect();\n             // Calculate relative position carefully\n             // textArea.style.left/top are relative to container if container is positioned?\n             // Assuming container is relative/absolute. \n             // We set style.left/top based on mouse event which is relative to canvas/container.\n             // So we can parse style.\n             // We need to subtract canvas offset if any, to get relative to canvas (0,0) for shape coords\n             // Wait, shape coords are relative to canvas (0,0).\n             // textArea.style.left was set as: x + canvas.offsetLeft\n             // So x = parseFloat(style.left) - canvas.offsetLeft\n             const x = parseFloat(this.textArea.style.left) - this.canvas.offsetLeft;\n             const y = parseFloat(this.textArea.style.top) - this.canvas.offsetTop;\n             \n             const textShape = new TextShape({\n                x, y, text: val,\n                strokeColor: this.currentColor,\n                lineWidth: this.currentLineWidth\n             });\n             this.shapes.push(textShape);\n        }\n    } else if (this.activeTextShape) {\n        // Empty text on existing shape -> remove it? \n        // Or just keep empty. Let's remove for cleanliness.\n        this.saveState();\n        this.shapes = this.shapes.filter(s => s !== this.activeTextShape);\n    }\n\n    this.textArea.style.display = 'none';\n    this.textArea.value = '';\n    this.activeTextShape = null;\n    this.render();\n  }\n\n  private resizeCanvas(width: number, height: number) {\n    this.canvas.width = width;\n    this.canvas.height = height;\n    this.canvas.style.width = `${width}px`;\n    this.canvas.style.height = `${height}px`;\n  }\n\n  private initEvents() {\n    this.canvas.addEventListener('mousedown', this.handleMouseDown.bind(this));\n    this.canvas.addEventListener('mousemove', this.handleMouseMove.bind(this));\n    this.canvas.addEventListener('mouseup', this.handleMouseUp.bind(this));\n    this.canvas.addEventListener('mouseleave', () => {\n        this.mousePos = null;\n        this.render();\n    });\n\n    this.canvas.addEventListener('dblclick', (e) => {\n        const { x, y } = this.getMousePos(e);\n        // Find text shape to edit\n        for (let i = this.shapes.length - 1; i >= 0; i--) {\n            const shape = this.shapes[i];\n            if (shape instanceof TextShape && shape.hitTest(x, y)) {\n                this.activeTextShape = shape;\n                this.textArea.value = shape.text;\n                this.textArea.style.left = (shape.x + this.canvas.offsetLeft) + 'px';\n                this.textArea.style.top = (shape.y + this.canvas.offsetTop) + 'px';\n                this.textArea.style.display = 'block';\n                this.textArea.style.color = shape.strokeColor;\n                this.textArea.style.width = 'auto';\n                this.textArea.style.height = 'auto';\n                // Trigger auto-size\n                const event = new Event('input');\n                this.textArea.dispatchEvent(event);\n                this.textArea.focus();\n                break;\n            }\n        }\n    });\n    \n    document.addEventListener('keydown', (e) => {\n      if (e.key === 'Delete' || e.key === 'Backspace') {\n        if (this.selectedShape) {\n          this.saveState(); // Save before delete\n          this.shapes = this.shapes.filter(s => s !== this.selectedShape);\n          this.selectShape(null);\n          this.render();\n        }\n      }\n      if ((e.ctrlKey || e.metaKey) && e.key === 'z') {\n        e.preventDefault();\n        this.undo();\n      }\n      if ((e.ctrlKey || e.metaKey) && e.key === 'y') {\n        e.preventDefault();\n        this.redo(); // Assuming HistoryManager has redo, but interface only showed undo? Check later.\n        // Actually HistoryManager implementation in summary showed undo and push, but hinted at redoStack.\n        // I will double check HistoryManager.\n      }\n    });\n  }\n\n  private getMousePos(e: MouseEvent) {\n    const rect = this.canvas.getBoundingClientRect();\n    return {\n      x: e.clientX - rect.left,\n      y: e.clientY - rect.top\n    };\n  }\n\n  // --- Mosaic Helper ---\n  private createMosaicPattern(): CanvasPattern | null {\n    // 1. Create a temp canvas with current state\n    const tempCanvas = document.createElement('canvas');\n    tempCanvas.width = this.canvas.width;\n    tempCanvas.height = this.canvas.height;\n    const tCtx = tempCanvas.getContext('2d')!;\n    \n    // Draw background and shapes (excluding current being drawn if any? No, we want what's there)\n    // Actually, we want to pixelate the *background* mostly, or everything?\n    // User said \"eraser-like effect\". So it should pixelate whatever is under it.\n    // So we draw the current scene.\n    if (this.backgroundImage) {\n      tCtx.drawImage(this.backgroundImage, 0, 0, tempCanvas.width, tempCanvas.height);\n    } else {\n      tCtx.fillStyle = this.backgroundColor;\n      tCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);\n    }\n    this.shapes.forEach(s => s.draw(tCtx));\n\n    // 2. Pixelate\n    // Draw scaled down then up\n    const pixelSize = 10;\n    const w = tempCanvas.width;\n    const h = tempCanvas.height;\n    const sw = Math.ceil(w / pixelSize);\n    const sh = Math.ceil(h / pixelSize);\n\n    // Create a tiny canvas for downscaling\n    const tinyCanvas = document.createElement('canvas');\n    tinyCanvas.width = sw;\n    tinyCanvas.height = sh;\n    const tinyCtx = tinyCanvas.getContext('2d')!;\n    tinyCtx.drawImage(tempCanvas, 0, 0, w, h, 0, 0, sw, sh);\n\n    // Draw back to tempCanvas with smoothing disabled\n    tCtx.imageSmoothingEnabled = false;\n    tCtx.drawImage(tinyCanvas, 0, 0, sw, sh, 0, 0, w, h);\n\n    return this.ctx.createPattern(tempCanvas, 'no-repeat');\n  }\n\n  private handleMouseDown(e: MouseEvent) {\n    const { x, y } = this.getMousePos(e);\n\n    // Force finish text editing if active\n    if (this.textArea.style.display === 'block') {\n        this.finishTextEditing();\n    }\n\n    this.startX = x;\n    this.startY = y;\n    this.isDragging = true;\n\n    if (this.currentTool === 'text') {\n        this.textArea.value = '';\n        this.textArea.style.left = (x + this.canvas.offsetLeft) + 'px';\n        this.textArea.style.top = (y + this.canvas.offsetTop) + 'px';\n        this.textArea.style.display = 'block';\n        this.textArea.style.color = this.currentColor;\n        this.textArea.style.width = '20px';\n        this.textArea.style.height = '24px';\n        setTimeout(() => this.textArea.focus(), 0);\n        this.activeTextShape = null;\n        return;\n    }\n\n    if (this.currentTool === 'select') {\n      // Check Transformer handles first if shape is selected\n      if (this.selectedShape) {\n        const handleIndex = this.transformer.hitTest(x, y, this.ctx);\n        if (handleIndex !== -1) {\n          this.transformHandleIndex = handleIndex;\n          this.saveState(); // Save before transform\n          return;\n        }\n      }\n\n      // Hit test for selection\n      let foundShape: BaseShape | null = null;\n      for (let i = this.shapes.length - 1; i >= 0; i--) {\n        if (this.shapes[i].hitTest(x, y)) {\n          foundShape = this.shapes[i];\n          break;\n        }\n      }\n\n      if (foundShape !== this.selectedShape) {\n        this.selectShape(foundShape);\n      }\n      \n      // If we clicked a shape (even if already selected), we might drag it\n      if (foundShape) {\n        this.transformHandleIndex = -2; // Special index for 'drag'\n        this.saveState(); // Save before drag\n      } else {\n        this.selectShape(null);\n      }\n    } else {\n      // Start drawing - Save state first\n      this.saveState();\n      this.selectShape(null); \n      \n      switch (this.currentTool) {\n        case 'rect':\n          this.currentShape = new Rect({\n            x, y, width: 0, height: 0,\n            strokeColor: this.currentColor,\n            lineWidth: this.currentLineWidth\n          });\n          break;\n        case 'circle':\n          this.currentShape = new Circle({\n            x, y, radius: 0,\n            strokeColor: this.currentColor,\n            lineWidth: this.currentLineWidth\n          });\n          break;\n        case 'arrow':\n          this.currentShape = new Arrow({\n            x, y, endX: x, endY: y,\n            strokeColor: this.currentColor,\n            lineWidth: this.currentLineWidth\n          });\n          break;\n        case 'pen':\n          this.currentPenPath = [{ x, y }];\n          this.currentShape = new PenPath({\n            x, y, points: this.currentPenPath,\n            strokeColor: this.currentColor,\n            lineWidth: this.currentLineWidth\n          });\n          break;\n        case 'mosaic':\n          const pattern = this.createMosaicPattern();\n          const brush = new MosaicBrush({\n            x, y, points: [{x, y}],\n            strokeColor: this.currentColor, // Ignored? Or used as fallback\n            lineWidth: this.currentLineWidth * 2 // Make mosaic thicker\n          });\n          brush.pattern = pattern;\n          this.currentShape = brush;\n          this.currentPenPath = [{ x, y }]; // Reuse pen path logic for points\n          break;\n      }\n\n      if (this.currentShape) {\n        this.shapes.push(this.currentShape);\n      }\n    }\n    this.render();\n  }\n\n  private handleMouseMove(e: MouseEvent) {\n    const { x, y } = this.getMousePos(e);\n    this.mousePos = { x, y };\n\n    if (this.isDragging) {\n      if (this.currentTool === 'select' && this.selectedShape) {\n        if (this.transformHandleIndex === -2) {\n          // Dragging shape\n          const dx = x - this.startX;\n          const dy = y - this.startY;\n          this.selectedShape.move(dx, dy);\n          this.startX = x;\n          this.startY = y;\n        } else if (this.transformHandleIndex !== -1) {\n          if (this.transformHandleIndex === 4) { // Rotate handle\n              const bounds = this.transformer.getShapeBounds(this.selectedShape, this.ctx);\n              const centerX = bounds.x + bounds.width / 2;\n              const centerY = bounds.y + bounds.height / 2;\n              const angle = Math.atan2(y - centerY, x - centerX);\n              // Snap to 45 deg?\n              this.selectedShape.rotation = angle + Math.PI / 2; // Adjust for handle position (usually top)\n          } else {\n               // Resize (simplified to just width/height for Rect, radius for Circle)\n               this.selectedShape.resize(x, y);\n          }\n        }\n      } else if (this.currentShape) {\n        // Drawing\n        if (this.currentTool === 'pen') {\n          this.currentPenPath.push({ x, y });\n          if (this.currentShape instanceof PenPath) {\n              this.currentShape.points.push({ x, y });\n          }\n        } else if (this.currentTool === 'mosaic') {\n          this.currentPenPath.push({ x, y });\n          // Update points in MosaicBrush\n          (this.currentShape as MosaicBrush).points = this.currentPenPath;\n        } else {\n          this.currentShape.resize(x, y);\n        }\n      }\n    } else {\n        this.updateCursorStyle(x, y);\n    }\n    this.render();\n  }\n\n  private updateCursorStyle(x: number, y: number) {\n    if (this.currentTool === 'select') {\n        if (this.selectedShape) {\n            const handle = this.transformer.hitTest(x, y, this.ctx);\n            switch (handle) {\n                case 0: this.canvas.style.cursor = 'nw-resize'; break;\n                case 1: this.canvas.style.cursor = 'ne-resize'; break;\n                case 2: this.canvas.style.cursor = 'se-resize'; break;\n                case 3: this.canvas.style.cursor = 'sw-resize'; break;\n                case 4: this.canvas.style.cursor = 'grab'; break; // Rotate\n                case -2: this.canvas.style.cursor = 'move'; break; // Drag inside\n                default: this.canvas.style.cursor = 'default'; break;\n            }\n        } else {\n            // Check if hovering over any shape\n             let found = false;\n             for (let i = this.shapes.length - 1; i >= 0; i--) {\n                if (this.shapes[i].hitTest(x, y)) {\n                    this.canvas.style.cursor = 'move';\n                    found = true;\n                    break;\n                }\n             }\n             if (!found) this.canvas.style.cursor = 'default';\n        }\n    } else if (this.currentTool === 'mosaic') {\n        this.canvas.style.cursor = 'none'; // Hide default cursor\n    } else {\n        this.canvas.style.cursor = 'crosshair';\n    }\n  }\n\n  private handleMouseUp(e: MouseEvent) {\n    if (!this.isDragging) return;\n    \n    this.isDragging = false;\n    this.currentShape = null;\n    this.transformHandleIndex = -1;\n  }\n\n  private selectShape(shape: BaseShape | null) {\n    this.shapes.forEach(s => s.isSelected = false);\n    this.selectedShape = shape;\n    if (shape) {\n      shape.isSelected = true;\n      this.transformer.attach(shape);\n    } else {\n      this.transformer.attach(null);\n    }\n    this.render();\n  }\n\n  public setTool(tool: ToolType) {\n    this.currentTool = tool;\n    this.selectShape(null);\n  }\n\n  public setColor(color: string) {\n    this.currentColor = color;\n    if (this.selectedShape) {\n      this.saveState();\n      this.selectedShape.strokeColor = color;\n      this.render();\n    }\n  }\n\n  public setLineWidth(width: number) {\n    this.currentLineWidth = width;\n    if (this.selectedShape) {\n      this.saveState();\n      this.selectedShape.lineWidth = width;\n      this.render();\n    }\n  }\n\n  public undo() {\n    const prevState = this.historyManager.undo(this.shapes);\n    if (prevState) {\n      this.shapes = prevState;\n      this.selectShape(null); // Deselect on undo to avoid ghost handles\n      this.render();\n    }\n  }\n  \n  public redo() {\n      // Optional: HistoryManager needs redo support\n  }\n\n  public reset() {\n    this.saveState();\n    this.shapes = [];\n    this.selectShape(null);\n    this.render();\n  }\n\n  private saveState() {\n    this.historyManager.push(this.shapes);\n  }\n\n  public render() {\n    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n\n    if (this.backgroundImage) {\n      this.ctx.drawImage(this.backgroundImage, 0, 0, this.canvas.width, this.canvas.height);\n    } else {\n      this.ctx.fillStyle = this.backgroundColor;\n      this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\n    }\n\n    this.shapes.forEach(shape => shape.draw(this.ctx));\n    \n    // Draw transformer on top\n    this.transformer.draw(this.ctx);\n\n    // Draw Mosaic Cursor\n    if (this.currentTool === 'mosaic' && this.mousePos) {\n        this.ctx.save();\n        this.ctx.beginPath();\n        const radius = this.currentLineWidth;\n        this.ctx.arc(this.mousePos.x, this.mousePos.y, radius, 0, Math.PI * 2);\n        this.ctx.strokeStyle = '#000';\n        this.ctx.lineWidth = 1;\n        this.ctx.stroke();\n        this.ctx.restore();\n    }\n  }\n\n  public exportDataURL(): string {\n    const prevSelection = this.selectedShape;\n    this.selectShape(null);\n    this.render(); // Re-render without handles\n    const data = this.canvas.toDataURL('image/png');\n    if (prevSelection) this.selectShape(prevSelection);\n    return data;\n  }\n}\n", "/*\r\n * @Author: YEYI millerye1995@foxmail.com\r\n * @Date: 2025-11-26 19:33:36\r\n * @LastEditors: YEYI millerye1995@foxmail.com\r\n * @LastEditTime: 2025-11-26 19:33:40\r\n * @FilePath: \\image-editor\\src\\ui\\Icons.ts\r\n * @Description: \u8FD9\u662F\u9ED8\u8BA4\u8BBE\u7F6E,\u8BF7\u8BBE\u7F6E`customMade`, \u6253\u5F00koroFileHeader\u67E5\u770B\u914D\u7F6E \u8FDB\u884C\u8BBE\u7F6E: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE\r\n */\r\n// Icons\r\nexport const Icons = {\r\n    Select: `<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M3 3l7.07 16.97 2.51-7.39 7.39-2.51L3 3z\"/><path d=\"M13 13l6 6\"/></svg>`,\r\n    Rect: `<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"/></svg>`,\r\n    Circle: `<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><circle cx=\"12\" cy=\"12\" r=\"10\"/></svg>`,\r\n    Arrow: `<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\"/><polyline points=\"12 5 19 12 12 19\"/></svg>`,\r\n    Pen: `<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z\"/></svg>`,\r\n    Text: `<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><polyline points=\"4 7 4 4 20 4 20 7\"/><line x1=\"9\" y1=\"20\" x2=\"15\" y2=\"20\"/><line x1=\"12\" y1=\"4\" x2=\"12\" y2=\"20\"/></svg>`,\r\n    Mosaic: `<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M4 4h16v16H4z\"/><path d=\"M4 8h16M4 12h16M4 16h16M8 4v16M12 4v16M16 4v16\"/></svg>`,\r\n    Undo: `<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M3 7v6h6\"/><path d=\"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13\"/></svg>`,\r\n    Reset: `<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8\"/><path d=\"M3 3v5h5\"/></svg>`,\r\n    Export: `<svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"/><polyline points=\"7 10 12 15 17 10\"/><line x1=\"12\" y1=\"15\" x2=\"12\" y2=\"3\"/></svg>`\r\n};\r\n", "import { ImageEditor, ToolType } from '../core/Editor';\nimport { Icons } from './Icons';\n\nexport class Toolbar {\n  private container: HTMLElement;\n  private editor: ImageEditor;\n  private tools: { type: ToolType; icon: string }[] = [\n    { type: 'select', icon: Icons.Select },\n    { type: 'rect', icon: Icons.Rect },\n    { type: 'circle', icon: Icons.Circle },\n    { type: 'arrow', icon: Icons.Arrow },\n    { type: 'pen', icon: Icons.Pen },\n    { type: 'text', icon: Icons.Text },\n    { type: 'mosaic', icon: Icons.Mosaic },\n  ];\n\n  private labels = {\n      zh: {\n          select: '\u9009\u62E9',\n          rect: '\u77E9\u5F62',\n          circle: '\u5706\u5F62',\n          arrow: '\u7BAD\u5934',\n          pen: '\u753B\u7B14',\n          text: '\u6587\u5B57',\n          mosaic: '\u6253\u7801',\n          undo: '\u64A4\u9500',\n          reset: '\u91CD\u7F6E',\n          color: '\u989C\u8272: ',\n          width: '\u7C97\u7EC6: ',\n          export: '\u5BFC\u51FA',\n          confirmReset: '\u786E\u5B9A\u8981\u6E05\u7A7A\u6240\u6709\u5185\u5BB9\u5417\uFF1F'\n      },\n      en: {\n          select: 'Select',\n          rect: 'Rectangle',\n          circle: 'Circle',\n          arrow: 'Arrow',\n          pen: 'Pen',\n          text: 'Text',\n          mosaic: 'Mosaic',\n          undo: 'Undo',\n          reset: 'Reset',\n          color: 'Color: ',\n          width: 'Width: ',\n          export: 'Export',\n          confirmReset: 'Are you sure you want to reset all changes?'\n      }\n  };\n\n  constructor(container: HTMLElement, editor: ImageEditor) {\n    this.container = container;\n    this.editor = editor;\n    this.render();\n  }\n\n  private get t() {\n      return this.labels[this.editor.locale] || this.labels['zh'];\n  }\n\n  private render() {\n    this.container.innerHTML = '';\n    this.container.className = 'image-editor-toolbar';\n\n    // Actions Group (Undo, Reset)\n    const actionsContainer = document.createElement('div');\n    actionsContainer.className = 'tools-group'; // Reuse class for layout\n    \n    this.createButton(actionsContainer, Icons.Undo, this.t.undo, () => this.editor.undo());\n    this.createButton(actionsContainer, Icons.Reset, this.t.reset, () => {\n        this.editor.reset();\n    });\n\n    this.container.appendChild(actionsContainer);\n\n    // Separator\n    const sep1 = document.createElement('div');\n    sep1.style.width = '1px';\n    sep1.style.height = '24px';\n    sep1.style.background = '#ccc';\n    sep1.style.margin = '0 5px';\n    this.container.appendChild(sep1);\n\n    // Tools Group\n    const toolsContainer = document.createElement('div');\n    toolsContainer.className = 'tools-group';\n\n    this.tools.forEach(tool => {\n      const btn = document.createElement('button');\n      btn.innerHTML = tool.icon;\n      btn.title = this.t[tool.type as keyof typeof this.t] || tool.type;\n      btn.className = 'tool-btn mode-btn';\n      btn.onclick = () => {\n        this.editor.setTool(tool.type);\n        this.setActive(btn);\n      };\n      if (tool.type === 'select') btn.classList.add('active');\n      toolsContainer.appendChild(btn);\n    });\n\n    this.container.appendChild(toolsContainer);\n\n    // Attributes Group\n    const attrsContainer = document.createElement('div');\n    attrsContainer.className = 'attrs-group';\n\n    // Color picker\n    const colorLabel = document.createElement('label');\n    colorLabel.innerText = this.t.color;\n    const colorInput = document.createElement('input');\n    colorInput.type = 'color';\n    colorInput.value = '#ff0000';\n    colorInput.onchange = (e) => {\n      this.editor.setColor((e.target as HTMLInputElement).value);\n    };\n    attrsContainer.appendChild(colorLabel);\n    attrsContainer.appendChild(colorInput);\n\n    // Width picker\n    const widthLabel = document.createElement('label');\n    widthLabel.innerText = this.t.width;\n    const widthInput = document.createElement('input');\n    widthInput.type = 'range';\n    widthInput.min = '1';\n    widthInput.max = '20';\n    widthInput.value = '2';\n    widthInput.onchange = (e) => {\n      this.editor.setLineWidth(parseInt((e.target as HTMLInputElement).value));\n    };\n    attrsContainer.appendChild(widthLabel);\n    attrsContainer.appendChild(widthInput);\n    \n    // Export button\n    this.createButton(attrsContainer, Icons.Export, this.t.export, () => {\n        const url = this.editor.exportDataURL();\n        const win = window.open();\n        win?.document.write('<img src=\"' + url + '\"/>');\n    });\n\n    this.container.appendChild(attrsContainer);\n  }\n\n  private createButton(container: HTMLElement, icon: string, title: string, onClick: () => void) {\n      const btn = document.createElement('button');\n      btn.innerHTML = icon;\n      btn.title = title;\n      btn.className = 'tool-btn';\n      btn.onclick = onClick;\n      container.appendChild(btn);\n      return btn;\n  }\n\n  private setActive(btn: HTMLElement) {\n    const btns = this.container.querySelectorAll('.tools-group .tool-btn'); // Only tool buttons\n    // Actually we have two groups with class 'tools-group'.\n    // We only want to deactivate buttons in the \"Tools Group\", not actions.\n    // The actions don't have \"active\" state in the same way (they are momentary).\n    // So we should verify which button is clicked.\n    // The tool buttons are in the second container.\n    // Let's just remove active from all siblings of the clicked button?\n    // Or keep it simple: Select all tool-btns that map to tools.\n    // Easier: Store tool buttons in an array or give them a specific class 'mode-btn'.\n    \n    // Let's refine:\n    // Only tools need active state.\n    // Actions don't.\n    // I will modify the loop for tools to add a class 'mode-btn'.\n    \n    // Re-implementing logic in `render` to add class, then here:\n    const modeBtns = this.container.querySelectorAll('.mode-btn');\n    modeBtns.forEach(b => b.classList.remove('active'));\n    \n    if (btn.classList.contains('mode-btn')) {\n        btn.classList.add('active');\n    }\n  }\n}\n", "import { ImageEditor } from './core/Editor';\r\nimport { Toolbar } from './ui/Toolbar';\r\n\r\nexport class EditorApp {\r\n  editor: ImageEditor;\r\n  toolbar: Toolbar;\r\n\r\n  constructor(containerId: string, options: { width: number; height: number; backgroundImage?: string }) {\r\n    const root = document.getElementById(containerId);\r\n    if (!root) throw new Error('Container not found');\r\n\r\n    // Layout\r\n    const toolbarContainer = document.createElement('div');\r\n    const editorContainer = document.createElement('div');\r\n    root.appendChild(toolbarContainer);\r\n    root.appendChild(editorContainer);\r\n\r\n    this.editor = new ImageEditor({\r\n      container: editorContainer,\r\n      width: options.width,\r\n      height: options.height,\r\n      backgroundImage: options.backgroundImage\r\n    });\r\n\r\n    this.toolbar = new Toolbar(toolbarContainer, this.editor);\r\n  }\r\n}\r\n\r\n// For browser global usage\r\n(window as any).ImageEditorApp = EditorApp;\r\n"],
  "mappings": "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",
  "names": []
}
